-- Allow users to update their own role to 'subscribed' (for subscription purchases)
CREATE POLICY "Users can upgrade to subscribed role"
ON public.user_roles
FOR UPDATE
TO authenticated
USING (auth.uid() = user_id)
WITH CHECK (auth.uid() = user_id AND role = 'subscribed');